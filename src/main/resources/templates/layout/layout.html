<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/springsecurity6" class="h-100">
<head>
    <meta charset="UTF-8">
    <title layout:title-pattern="$CONTENT_TITLE | $LAYOUT_TITLE">맛슐랭 원정대</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/css/main.css}" rel="stylesheet" />

    <style>
        /* 데스크탑 화면에서 메뉴가 항상 보이도록 하는 스타일 */
        @media (min-width: 992px) {
            .navbar-collapse {
                display: flex !important;
            }
        }

        /* ▼▼▼▼▼ [수정] 충돌 없는 수동 메뉴 제어를 위한 CSS ▼▼▼▼▼ */
        @media (max-width: 991.98px) {
            .navbar-collapse {
                /* 평소에는 메뉴를 숨김 */
                display: none;
                /* 헤더 바로 아래에 펼쳐지도록 위치 설정 */
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background-color: #f8f9fa; /* 헤더와 동일한 배경색 */
                border-top: 1px solid rgba(0,0,0,.1);
                box-shadow: 0 0.5rem 1rem rgba(0,0,0,.15);
                z-index: 1021; /* 다른 요소 위에 오도록 설정 */
            }
            /* is-open 클래스가 추가되면 메뉴를 보여줌 */
            .navbar-collapse.is-open {
                display: block;
            }
        }
        /* ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲ */

        /* 기존 로그인/로그아웃 버튼 스타일 */
        .auth-button {
            margin-left: 10px; padding: .375rem .75rem; font-size: 1rem;
            line-height: 1.5; border-radius: .25rem; text-decoration: none;
            color: #fff; background-color: #0d6efd; border: 1px solid #0d6efd;
            transition: all .15s ease-in-out;
        }

        .auth-button:hover {
            background-color: #0b5ed7; /* 호버 시 색상 */
            border-color: #0a58ca;
            color: #fff;
        }

        /* 폼 버튼 리셋 (기본 폼 버튼 스타일 제거) */
        .auth-button-form button {
            all: unset; cursor: pointer; margin-left: 10px;
            padding: .375rem .75rem; font-size: 1rem; line-height: 1.5;
            border-radius: .25rem; text-decoration: none; color: #fff;
            background-color: #0d6efd; border: 1px solid #0d6efd;
            transition: all .15s ease-in-out;
        }
        .auth-button:hover, .auth-button-form button:hover {
            background-color: #0b5ed7; border-color: #0a58ca; color: #fff;
        }

        .user-info-display {
            display: flex; /* 가로 정렬 */
            flex-direction: column; /* 세로로 나열 */
            align-items: flex-end; /* 오른쪽 정렬 */
            margin-right: 15px; /* 로그인/로그아웃 버튼과의 간격 */
            font-size: 0.85rem; /* 기본 폰트 크기 */
            color: #555; /* 글자색 */
            line-height: 1.2; /* 줄 간격 */
        }

        .user-info-display .user-nickname {
            font-weight: bold; /* 닉네임은 조금 더 진하게 */
            color: #333; /* 닉네임 색상 */
            font-size: 0.9rem; /* 닉네임 크기 */
        }

        .user-info-display .user-role {
            font-size: 0.75rem; /* 역할은 더 작게 */
            color: #888; /* 역할 색상 */
            text-transform: uppercase; /* 역할을 대문자로 표시 */
        }

        /* 수정: 비로그인 상태일 때 텍스트 스타일 */
        .user-info-display .text-muted-smaller {
            font-size: 0.7rem; /* 로그인 시보다 더 작게 */
            color: #aaa; /* 더 흐린 색상 */
        }

        /* 모바일 뷰에서 닉네임/역할과 버튼이 너무 붙지 않도록 조정 (선택 사항) */
        @media (max-width: 991.98px) {
            .user-info-display {
                margin-right: 0;
                margin-bottom: 10px; /* 메뉴 항목 아래에 약간의 간격 */
                align-items: flex-start; /* 모바일에서는 왼쪽 정렬 */
            }
        }

    </style>
    <th:block layout:fragment="css"></th:block>
</head>
<body class="d-flex flex-column h-100">

<header class="navbar navbar-expand-lg navbar-light bg-light position-relative">
    <div class="container">
        <a class="navbar-brand" th:href="@{/main}" style="height: 50px; display: flex; align-items: center; overflow: hidden;">
            <img th:src="@{/layoutIMAGE/5.png}" alt="로고" style="height: 100%; object-fit: contain;">오점머
        </a>

        <button class="navbar-toggler" type="button" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- 문구 수정은 CommonControllerAdvice.java 에서 수정하면됨 -->
        <div class="d-flex align-items-center">
            <div class="user-info-display me-3">
                <span class="user-nickname" th:text="${loggedInUserNickname}" th:classappend="${loggedInUserNickname == '비로그인'} ? 'text-muted-smaller' : ''">닉네임</span>
                <span class="user-role" th:text="${loggedInUserRole}" th:classappend="${loggedInUserNickname == '비로그인'} ? 'text-muted-smaller' : ''">역할</span>
            </div>
            <!---->

        <div class="navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" th:href="@{/board/list}">맛슐랭원정대</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/review/list}">식후감</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/lunchmatch/list}">맛집저장</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/lunchmatch/map}">맛지도</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/myPage}">MY PAGE</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/inquiry/list}">1:1문의</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/notice/list}">공지사항</a></li>
            </ul>

            <div class="d-flex align-items-center">
                <div sec:authorize="!isAuthenticated()"><a th:href="@{/login}" class="auth-button">로그인</a></div>
                <div sec:authorize="isAuthenticated()" class="auth-button-form">
                    <form th:action="@{/logout}" method="post">
                        <div th:if="${_csrf}"><input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" /></div>
                        <button type="submit" class="auth-button">로그아웃</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</header>

<main class="flex-grow-1">
    <div class="container">
        <div layout:fragment="content">
        </div>
    </div>
</main>

<footer class="mt-auto bg-light">
    <hr/>
    <div class="container text-center py-3">
        <p>&copy; 2025 오늘 점심 뭐 먹지? All rights reserved.</p>
    </div>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var toggler = document.querySelector('.navbar-toggler');
        var collapseMenu = document.getElementById('navbarNav');

        if (toggler && collapseMenu) {
            toggler.addEventListener('click', function () {
                // Bootstrap의 JS 기능 대신, is-open 이라는 클래스를 직접 제어합니다.
                collapseMenu.classList.toggle('is-open');
            });
        }
    });
</script>
<th:block layout:fragment="script"></th:block>
</body>
</html>